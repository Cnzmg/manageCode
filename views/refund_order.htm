<!DOCTYPE html>
<html>

<head>
	<meta charset="UTF-8">
	<meta name="viewport"
		content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
	<title>Business Refund Order ~</title>
	<link rel="stylesheet" href="http://www.cbcoffee.cn/sharedcoffee/asset/css/reset.css" />

	<link rel="stylesheet" href="mui.min.css">
	<link rel="stylesheet" type="text/css" href="occ.css" />

	<script src="http://www.cbcoffee.cn/manage/js/jquery.min.js" type="text/javascript" charset="utf-8"></script>
	<script src="http://at.alicdn.com/t/font_1049864_zdzz8ea7z5.js"></script>
</head>

<body>
	<div style="display:none;" id="offCanvasWrapper"
		class="mui-off-canvas-wrap mui-draggable  mui-scalable ben-side-header">
		<aside id="offCanvasSide" class="mui-off-canvas-left">
			<div id="offCanvasSideScroll" class=" mui-scroll-wrapper">
				<div class="mui-scroll">
					<header class="mui-bar mui-bar-nav off-nav ym_header">
						<a href="#offCanvasSide" class="mui-icon icon-size20  mui-pull-left close-icon ">
							<svg class="icon" aria-hidden="true">
								<use xlink:href="#ym-icon-guanbi"></use>
							</svg>
						</a>
						<h1 class="mui-title"><img src="/sharedcoffeeCode/image/icons/logo.png" style="width:38px;" />
						</h1>
					</header>

					<ul class="mui-table-view mui-table-view-inverted ym-menu-tag">
						<li class="mui-table-view-cell">
							<a href="./car_index.htm"><span>
									<svg class="icon" aria-hidden="true">
										<use xlink:href="#ym-icon-dingdan"></use>
									</svg>
									支付订单 </span></a>
						</li>
						<li class="mui-table-view-cell">
							<a href="./car_index.htm"><span>
									<svg class="icon" aria-hidden="true">
										<use xlink:href="#ym-icon-tuikuan"></use>
									</svg>
									退款订单</span></a>
						</li>
						<li class="mui-table-view-cell">
							<a href="./car_index.htm"><span>
									<svg class="icon" aria-hidden="true">
										<use xlink:href="#ym-icon-tuichu"></use>
									</svg>
									退出登陆</span></a>
						</li>
					</ul>
				</div>
			</div>
		</aside>
		<div class="mui-inner-wrap">
			<header class="mui-bar mui-bar-nav ym_header">
				<a href="#offCanvasSide" class="mui-icon mui-pull-left icon-size20 more-icon">
					<svg class="icon" aria-hidden="true">
						<use xlink:href="#ym-icon-caidan"></use>
					</svg>
				</a>
				<h1 class="mui-title"><img src="/sharedcoffeeCode/image/icons/logo.png" style="width:38px;" /></h1>
			</header>
			<div id="offCanvasContentScroll" class="mui-content mui-scroll-wrapper mui-fullscreen"
				style="padding-top:46px;">
				<div class="mui-scroll" id="mui-message">

				</div>
			</div>
			<div class="mui-scrollbar mui-scrollbar-vertical" style="transition-duration: 500ms; opacity: 0;">
				<div class="mui-scrollbar-indicator"
					style="transition-duration: 0ms; display: block; height: 48px; transform: translate3d(0px, 549px, 0px) translateZ(0px); transition-timing-function: cubic-bezier(0.165, 0.84, 0.44, 1);">
				</div>
			</div>
			<div class="mui-off-canvas-backdrop"></div>
		</div>

	</div>

	<script src="mui.min.js"></script>
	<script type="text/javascript">
		function _changeFn() { };
		var ace = {
			package: {
				uri: {
					dress: 'http://mapi.cbcoffee.cn/',
					clothes: 'http://test.cbcoffee.cn:8080/'
				},
				w: jQuery('.c-footer-icon img').width() / 3,
				h: jQuery('.c-footer-icon img').height() / 3,
				user: document.getElementById("user"),
				password: document.getElementById("pwd"),
				btn: document.getElementById("coffeeLogin"),
				dom: {
					garden: jQuery('.c-footer-icon'),
					eye: jQuery('.c-garden-snail-icon')
				},
				bool: false,
				loading: `<div class="k-ball7a"><\/div><div class="k-ball7b"><\/div><div class="k-ball7c"><\/div><div class="k-ball7d"><\/div>`,
				acDom: document.createElement('div'),
				orderList: {},
				body: {
					// DIV: `<div class="order-body"><div class="active-list"><\/div><div class="footer"><div class="menu-search" data-click=false><span class="menu">菜单<\/span><ul><li class="search"><div class="search-input"><input id=search type=text placeholder="输入订单号" \/><div onclick=ace.orderactive({PAGE:1,NAME:jQuery('#search').val()})>搜索<\/div><\/div><\/li><li class="_goHome">返回首页<\/li><li class="_gobreak">切换账号<\/li><\/ul><\/div><\/div><\/div>`
				},
				page: 1
			},
			order_back: function () {
				var arg = arguments[0];
				jQuery.ajax({
					url: ace.package.uri.dress + 'refund_order_list',
					data: `name=${arg.NAME}&page=${arg.PAGE}&url=\/manage\/refundOrder.html&id=${JSON.parse(sessionStorage.getItem('secretkey')).ID}&token=${JSON.parse(sessionStorage.getItem('secretkey')).TOKEN}`,
					async:true
				})
					.done(function (res) {
						switch (res.statusCode.status) {
							case 6666:
								setTimeout(function (e = "") {
									ace.package.bool == true || arg.NAME ? ~function(){
										jQuery('#offCanvasWrapper').fadeIn(2000);
										jQuery('.c-container-body').hide();
										jQuery('.mui-pull-bottom-pocket').remove();
									}() : null;
									for (let i = 0; i < res.orders.length; i++) {
										e+= `<div class="m-order-list" data-order=${res.orders[i].orderId}>
												<div class="m-page-order">${arg.PAGE > 1 ? parseInt(arg.PAGE + (i + 1)) : (i + 1)}</div>
												<div class="m-order-number">
													${res.orders[i].paymentMoney.split('.')[0]}<em>.${res.orders[i].paymentMoney.split('.')[1].substring(0,2)}</em>
												</div>
												<div class="m-order-message">
													<p>订单号：${res.orders[i].orderId.replace(/(.{5}).*(.{3})/,"$1******$2")}</p>
													<p>消费金额：${parseFloat(res.orders[i].spendingMoney).toFixed(2)}</p>
													<p>支付类型：${res.orders[i].paymentType}</p>
													<p>消费方式：${res.orders[i].consumptionType}</p>
													<p>订单状态：${res.orders[i].orderStatus}</p>
													<p>创建时间：${res.orders[i].createTime}</p>
													<p>交易时间：${res.orders[i].paymentTime}</p>
												</div></div>`;
									}
									ace.package.bool = false;
									jQuery('#mui-message').append(e);
									jQuery('.more').on('click', function () {
										jQuery(this).append(`<div class="k-ball-holder" style="position:absolute;left:30%;top:30%;">${ace.package.loading}</div>`);
										ace.order_back({ PAGE: arg.PAGE + 1, DELAY: 1000, NAME: arg.NAME });
									});
									jQuery('.refund-span').on('click', function (e) {
										e.stopPropagation();
										ace._refund();
									});
								}, arg.DELAY);
								sessionStorage.setItem('page',parseInt(arg.PAGE) + 1);
								break;
							case 4444:
								console.log('this is null code~');
								jQuery('.active-list').html('<span class="empty">Query data is empty</span>');
								jQuery('.more').on('click', function () {
									jQuery(this).append(`<div class="k-ball-holder" style="position:absolute;left:30%;top:30%;">${ace.package.loading}</div>`);
									ace.order_back({ PAGE: 1, DELAY: 0, NAME: '' });
								}).text('返回');
							default:
								console.log('订单系统异常');
								jQuery('.module').show().text(res.statusCode.msg);
								setTimeout(() => {
									jQuery('.module').hide()
								}, 2000);
								return false;

						}
					});
			},
			_callback: function () {
				sessionStorage.clear();
				window.location.href = window.location.href + "?delay=" + new Date().getTime();
			}
		}
		ace.init();

		mui.init({
			pullRefresh: {
				container: "#offCanvasContentScroll",//待刷新区域标识，querySelector能定位的css选择器均可，比如：id、.class等
				up: {
					callback: function(){
						this.endPullupToRefresh(false);
						var page = ace.orderactive({
							ID:JSON.parse(sessionStorage.getItem('secretkey')).ID,
							TOKEN:JSON.parse(sessionStorage.getItem('secretkey')).TOKEN,
							PAGE: sessionStorage.getItem('page') ? sessionStorage.getItem('page') : 1,
							NAME:''
						});
					}// this.endPullupToRefresh(true);
				}
			}
		});
		//主界面和侧滑菜单界面均支持区域滚动；
		mui('#offCanvasContentScroll').scroll({
			indicators: false, //是否显示滚动条
			deceleration: 0.005, //阻尼系数,系数越小滑动越灵敏
		});
		mui('#offCanvasContentScroll').scroll({
			indicators: true, //是否显示滚动条
			deceleration: 0.005, //阻尼系数,系数越小滑动越灵敏
			bounce: true //是否启用回弹

        });
        mui('body').on('tap','a',function(){document.location.href=this.href;}); //处理a标签跳转页面
	</script>
</body>

</html>