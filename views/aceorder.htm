<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
		<title>Business Operations Order ~</title>
		<link rel="stylesheet" href="http://www.cbcoffee.cn/sharedcoffee/asset/css/reset.css" />
		<link rel="stylesheet" type="text/css" href="occ.css" />
		<script src="http://www.cbcoffee.cn/manage/js/jquery.min.js" type="text/javascript" charset="utf-8"></script>
	</head>

	<body>
		<div class="c-container-body">
			<div class="c-backups-land land ">
				<!--登陆-->
				<div class="c-land-logo">
					<img src="/sharedcoffeeCode/image/icons/logo.png" />
				</div>
				<form method="post">
					<div class="c-land">
						<div class="c-land-input">
							<ul>
								<li>
									<span></span>
									<input type="text" placeholder="账号" name="user" id="user" value="" />
								</li>
								<li>
									<span></span>
									<input type="password" placeholder="密码" name="pwd" id="pwd" value="" />
								</li>
							</ul>
						</div>
						<div id="coffeeLogin" class="c-click-submit" data-click='{"name":"c-land","key":"101859107-905758"}'>
							提交
						</div>
					</div>
				</form>
			</div>
			<div class="c-footer-icon">
				<img src="../public/images/icons/load_icon.png" alt="" />
				<div class="c-garden-snail-icon">

				</div>
				<div class="c-garden-snail-icon">

				</div>
			</div>
			<div class="c-title-wz">
				王者专享
			</div>
		</div>
		<div class="module"></div>
		<script type="text/javascript">
			function _changeFn(){};
			var ace = {
				package:{
					uri:{
						dress:'http://mapi.cbcoffee.cn/',
						clothes:'http://test.cbcoffee.cn:8080/'
					},
					w:jQuery('.c-footer-icon img').width() / 3,
					h:jQuery('.c-footer-icon img').height() / 3,
					user:document.getElementById("user"),
					password:document.getElementById("pwd"),
					btn:document.getElementById("coffeeLogin"),
					dom:{
						garden:jQuery('.c-footer-icon'),
						eye:jQuery('.c-garden-snail-icon')
					},
					bool:false,
					loading:`<div class="k-ball7a"><\/div><div class="k-ball7b"><\/div><div class="k-ball7c"><\/div><div class="k-ball7d"><\/div>`,
					acDom:document.createElement('div'),
					orderList:{},
					body:{
						DIV:`<div class="order-body"><div class="active-list"><\/div><div class="footer"><div class="menu-search" data-click=false><span class="menu">菜单<\/span><ul><li class="search"><div class="search-input"><input id=search type=text placeholder="输入订单号" \/><div onclick=ace.orderactive({PAGE:1,NAME:jQuery('#search').val()})>搜索<\/div><\/div><\/li><li class="_goHome">返回首页<\/li><li class="_gobreak">切换账号<\/li><\/ul><\/div><\/div><\/div>`
					},
					page:1
				},
				ui:function(){
					switch(typeof arguments[0]){
						case 'object':
							setTimeout(function(){
								jQuery('.module').fadeOut(100);
								ace.package.bool = false;
								ace.package.btn.innerHTML = '提交';
							},arguments[0].delay);
						break;
						default:
							console.log('state error');
					}
					ace.package.dom.garden.children('img').css({
						height: ace.package.h,
						width: ace.package.w
					});
					jQuery('body').off().delegate('.active-list ul','click',function(e){
						if(jQuery(this).attr('data-anicy') == "false"){
							jQuery(this).attr('data-anicy',true).children('div').fadeIn();
							jQuery(this).siblings('ul').attr('data-anicy',false).children('div').fadeOut();
						}else{
							jQuery(this).attr('data-anicy',false).children('div').fadeOut();
							jQuery(this).siblings('ul').attr('data-anicy',false);
						}
					});
					jQuery('body').delegate('.menu','click',function(){
						jQuery(this).parent('div').find('li').fadeToggle();
						ace._change();
						if(jQuery('.menu-search').css('position') == 'absolute'){
							jQuery('.active-list').animate({'marginTop':'160px'},500);
						}
						if(jQuery('.search').css('opacity') === '1'){jQuery('.active-list').animate({'marginTop':'50px'},500);}
					});
					jQuery('body').delegate('._gobreak','click',function(){
						ace._callback();
					});
					jQuery('body').delegate('._goHome','click',function(){
						window.location.href = window.location.href + "?delay=" + new Date().getTime();
					});
					jQuery(window).scroll(function () {
						if(jQuery(document).scrollTop() > 50){
							jQuery('.menu-search').css({'position':'fixed'});
							jQuery('.active-list').css('marginTop','50px');
						}else{
							jQuery('.menu-search').css({'position':'absolute'});
						}
					});
				},
				init:function(){
					ace.ui();
					ace.package.btn.onclick = function(){
						ace.package.bool == false ? ace.load(70) : null;
					}
					jQuery.ajaxSetup({
						dataType:'JSON',
						async:false,
						type:'POST'
					});
					sessionStorage.getItem('secretkey') ? ~function(){
						ace.package.bool = true;
						ace.orderactive({PAGE:ace.package.page,DELAY:0,NAME:''});
					}() : null;
				},
				load:function(){
					ace.package.acDom.innerHTML = `<div class="k-ball-holder" style="position:absolute;left:${arguments[0]/2}%;top:${arguments[0]/4}%;">${ace.package.loading}</div>`;
					ace.package.btn.append(ace.package.acDom);
					ace.package.bool = true;
					jQuery.ajax({
						url:ace.package.uri.clothes + 'admin_login',
						data:`adminName=${ace.package.user.value}&adminPwd=${ace.package.password.value}`
					})
					.done(function(res){
						switch(res.statusCode.status){
							case 2000:
								sessionStorage.setItem('secretkey',JSON.stringify({
									ID:res.id,
									TOKEN:res.token
								}));
								setTimeout(function(){
									$(".c-container-body").css({'-webkit-animation':"bounceIn 0.5s .25s ease both",'-moz-animation':'bounceIn 1s .25s ease both','animation':'bounceIn 0.5s .25s ease both'}).fadeOut(2000);
									ace.orderactive({
										PAGE:ace.package.page,
										ID:res.id,
										TOKEN:res.token,
										DELAY:1000,
										NAME:''
									});
								},1000);
								break;
							case 999:
								ace.package.bool = false;
								setTimeout(function(){
									jQuery('.module').show().text(res.statusCode.msg);
								},1000);
								ace.ui({
									delay:3000
								});
								break;
							default:
								ace.package.bool = false;
								console.log('异常错误');
						}
					})
				},
				orderactive:function(){
					var arg = arguments[0];
					jQuery.ajax({
						url:ace.package.uri.clothes + 'find_order_list',
						data:`name=${arg.NAME}&page=${arg.PAGE}&url=\/manage\/orderList.html&type=1&id=${JSON.parse(sessionStorage.getItem('secretkey')).ID}&token=${JSON.parse(sessionStorage.getItem('secretkey')).TOKEN}`,
					})
					.done(function(res){
						switch(res.statusCode.status){
							case 6666:
								setTimeout(function(e = ""){
									ace.package.bool == true || arg.NAME ? jQuery('body').html(ace.package.body.DIV) : null;
									for(let i = 0; i < res.orderShowList.length; i++){
										e += `<ul data-anicy=false>
											<li class=id>
												${res.orderShowList[i].orderId}
											<\/li>
											<li class=orderStatus>
												<div class=${res.orderShowList[i].orderStatus == "已完成" ? "colorgreen" : res.orderShowList[i].orderStatus == "制作中" ? "colorfff100" :"colorred"}><\/div>
											<\/li>
											<div class="message">
												<p> 用户ID:${res.orderShowList[i].userId}  <\/p>
												<p> 用户昵称:${res.orderShowList[i].nickName}   <\/p>
												<p> 支付时间:${res.orderShowList[i].paymentTime}  <\/p>
												<p> 订单状态:${res.orderShowList[i].orderStatus}  <\/p>
												<p> 产品名称:${res.orderShowList[i].productName}  <\/p>
												<p class=money> 产品金额:${parseFloat(res.orderShowList[i].paymentMoney * 100).toFixed(2)}  <\/p>
												<p>
													${
														res.orderShowList[i].orderStatus == "已取消" ? ""
														: res.orderShowList[i].orderStatus == "已退款" ? ""
														: res.orderShowList[i].orderStatus == "未支付" ? ""
														: res.orderShowList[i].orderStatus == "-1" ? ""
														: `<span class=refund-span data-value=orderId=${res.orderShowList[i].orderId}&refundLimit=${res.orderShowList[i].paymentMoney * 100}>退款</span>`
													}
												<\/p>
											<\/div>
										<\/ul>`;
									}
									ace.package.bool = false;
									jQuery('.more').remove();
									jQuery('.empty').remove();
									jQuery('.active-list').append(e).after(`<div class="more">点击加载更多<\/div>`);
									if(arg.NAME != ""){
										jQuery('.more').remove();
									}
									jQuery('.more').on('click',function(){
										jQuery(this).append(`<div class="k-ball-holder" style="position:absolute;left:30%;top:30%;">${ace.package.loading}</div>`);
										ace.orderactive({PAGE:arg.PAGE + 1,DELAY:1000,NAME:arg.NAME});
									});
									jQuery('.refund-span').on('click',function(e){
										e.stopPropagation();
										ace._refund();
									});
								},arg.DELAY);
								break;
							case 4444:
								console.log('this is null code~');
								jQuery('.active-list').html('<span class="empty">Query data is empty</span>');
								jQuery('.more').on('click',function(){
									jQuery(this).append(`<div class="k-ball-holder" style="position:absolute;left:30%;top:30%;">${ace.package.loading}</div>`);
									ace.orderactive({PAGE:1,DELAY:0,NAME:''});
								}).text('返回');
							default:
								console.log('订单系统异常');
						}
					});
				},
				_refund:function(){
					var arg = arguments[0],firm = confirm('退款前请核对信息无误！是否执行退款？');
					firm == true ? void function(){
						jQuery.ajax({
							url:ace.package.uri.clothes + 'order_refund',
							data:`${jQuery('.refund-span').attr('data-value')}&url=\/manage\/orderList.html&id=${JSON.parse(sessionStorage.getItem('secretkey')).ID}&token=${JSON.parse(sessionStorage.getItem('secretkey')).TOKEN}`,
						})
						.done(function(res){
							jQuery('body').append('<div class="module"></div>');
							jQuery('.module').show().text(res.statusCode.msg);
							ace.ui({
								delay:3000
							});
						})
					}() : null;
				},
				_change:function(){
					Function.prototype.extends = function(fn,delay){
					var delay = delay || 800,timer;
					return function(){
					    var fthis = this,arg = arguments;
					    if(timer) clearTimeout(timer);
					    timer = setTimeout(function(){
					     timer = null;
					     fn.apply(fthis,arg);
					    },delay);
					}
					}
					document.getElementById('search').addEventListener('input',_changeFn.extends(function (){
						ace.orderactive({PAGE:1,NAME:this.value})
					}),2000);
				},
				_callback:function(){
					sessionStorage.clear();
					window.location.href = window.location.href  + "?delay=" + new Date().getTime();
				}
			}
			ace.init();
		</script>
	</body>

</html>